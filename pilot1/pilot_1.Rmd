---
title: "Pilot 1"
output: html_notebook
---
```{r}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggbeeswarm)
```

# Summary

- Recruiting platform: Prolific
  - study code 29ABE0A0
  - base pay: $7
  - estimated time: 40 min
- Study website: https://mucollective.github.io/vis-insights-study/
- Database at AWS
- Exit survey at Qualtrics



# Prolific results


5e3d59338f20d3000a34aeb9
8 Feb 2020, 10:20
N/A
TIMED-OUT

5e3db42ae01a2602b2068256
8 Feb 2020, 10:20
00:23:56
29ABE0A0
AWAITING REVIEW


5d9f8573ce3daf0015e3e400
8 Feb 2020, 12:30
00:19:18
29ABE0A0
AWAITING REVIEW

```{r}
# before approval
# df_prolific <- read.csv("pilot_1_prolific_first_two.csv")
df_prolific <- read.csv("pilot_1_prolific_alles.csv")
```

```{r}
summary(df_prolific)
```


## Select participants
```{r}
participants <- df_prolific %>%
  filter(status %in% c("AWAITING REVIEW", "APPROVED"))%>%
  select(participant_id) %>%
  rename(prolific_pid = participant_id)
```



# Qualtrics exit survey

```{r}
# contains many more fake responses
df_qualtrics <- read.csv("pilot_1_qualtrics.csv") %>%
  rename(prolific_pid = PROLIFIC_PID) 

participants %>%
  inner_join(df_qualtrics, by = "prolific_pid") %>%
  select(prolific_pid, Q4, Q1, Q3)
```

# Database response records

## Read and clean data

```{r}
df_db <- read.csv("pilot_1_db_all.csv")
```

```{r}
summary(df_db)
```
Select participants

```{r}
df <- participants %>%
  inner_join(df_db, by="prolific_pid")
```

Problem: cumulative_pay not starting from 0 for `5d9f8573ce3daf0015e3e400`

```{r}
df %>%
  group_by(prolific_pid) %>%
  do( tail(.,1)) %>%
  select(prolific_pid, cumulative_pay)
```
```{r}
calc_payout <- function(tp, tn, fp, fn, a){
  a <- a/100
  tp* 20 + 
    tn* 20 + 
    fp* round(((1-a)/a) * 20) + 
    fn* 20
}
```


[] Validate calculation of payout per trial

```{r}
df %>%
  group_by(prolific_pid) %>%
  mutate(alt_payout = calc_payout(tp, tn, fp, fn, incentive)) %>%
  mutate(trial_pay = c(head(cumulative_pay, 1), diff(cumulative_pay))) %>%
  mutate(diff = alt_payout - trial_pay) %>%
  .$diff %>%
  sum()
```

## Individual final payouts (for bonus pay)

```{r}
df %>%
  group_by(prolific_pid) %>%
  summarize(net_pay = tail(cumulative_pay, 1))
```

## Explore data


```{r}
df <- df %>%
  group_by(prolific_pid) %>%
  mutate(p_trial_id = row_number()) %>%
  group_by(prolific_pid, incentive) %>%
  mutate(block_id = row_number()) %>%
  mutate(trial_pay = c(head(cumulative_pay, 1), diff(cumulative_pay)))
```


```{r}
df %>%
  ggplot(aes(block_id, trial_pay)) + 
  geom_point() +
  labs(x = "Trial # within a block", y = "Payout per trial") +
  facet_grid(prolific_pid ~ incentive/100)
 
# ggsave("pilot_1_all_participants_pertrial_payout.pdf", width = 6, height = 24) 
```


```{r}
df %>%
  ggplot(aes(
    x = factor(incentive/100), 
    y = fp, 
    color = prolific_pid)) + 
  geom_jitter() + 
  labs(x = "alpha", y = "# of false positives", title = "Each dot is a trial, colored by participants")
```
```{r}
df %>%
  group_by(incentive, fp) %>%
  ggplot(aes(fp)) +
  geom_bar() + 
  facet_grid(. ~ incentive/100) +
  labs(x = "# of false positives")
```

```{r}
df %>%
  group_by(incentive) %>%
  summarize(mean(trial_pay))
```

